<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <script src="https://lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script>
  <title>Title</title>
</head>
<div>
  <button id="current">Current</button>
  <button id="branches">Branches</button>
  <button id="builds">Build History</button>
  <button id="pull_requests">Pull Requests</button>

  <select>
    <option value="settings">Settings</option>
    <option value="requests">Requests</option>
    <option value="caches">Caches</option>
    <option value="trigger_build">Trigger Build</option>
  </select>

</div>

<div id="display"></div>
<script>
  url = location.href;

  array = url.split('/');

  baseUrl = "https://" + location.host;

  git_type = array[3];

  username = array[4];

  repo = array[5];

  type = array[6];

  query = git_type + '/' + username + '/' + repo;

  baseTitle = query + ' - KhsCI';

  /**
   * http://www.zhangxinxu.com/wordpress/2013/06/html5-history-api-pushstate-replacestate-ajax/
   */
  $("button").click(function () {
    let id = $(this).attr('id');
    history.replaceState(null, baseTitle, baseUrl + '/' + query + '/' + id);

    switch (id) {
      case "pull_requests":
        title = 'Pull Requests - ' + baseTitle;
        break;

      default:
        title = baseTitle;
    }

    if (id === 'builds') {
      title = 'Builds - ' + baseTitle;
    }

    $("title").text(title);

    $.ajax({
      type: "POST",
      url: location.href,
      success: function (data) {
        $("#display").text(data);
      }
    })

  });

  $("option").click(function () {
    let id = $(this).attr('value');
    history.replaceState(null, baseTitle, baseUrl + '/' + query + '/' + id);

    $('title').text(baseTitle);

    $.ajax({
      type: "post",
      url: location.href,

      success: function (data) {
        $("#display").text(data);
      }
    })

  });

  $(document).ready(function () {

    switch (type) {
      case "builds":
        title = 'Builds - ' + baseTitle;
        break;
      case "pull_requests":
        title = 'Pull Requests - ' + baseTitle;
        break;
      default :
        title = baseTitle;
    }

    $("title").text(title);

    $.ajax({
      type: "POST",
      url: location.href,
      success: function (data) {
        $("#display").text(data);

      }
    })

  });
</script>
</body>
</html>

{
    "title": "JSON schema for configuring PCIT CI/CD",
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "https://ci.khs1994.com",
    "$comment": "https://docs.ci.khs1994.com/usage/",
    "description": "see https://docs.ci.khs1994.com/usage/",
    "type": "object",
    "fileMatch": [
        ".pcit.yaml",
        ".pcit.yml",
        ".pcit/**.yaml",
        ".pcit/**.yml"
    ],
    "definitions": {
        "read_only": {
            "type": "boolean",
            "description": "Mount the container's root filesystem as read only",
            "default": false
        },
        "plugins": {
            "type": "object",
            "oneOf": [
                {
                    "description": "The github-release plugin is used to publish files and artifacts to GitHub Release.",
                    "properties": {
                        "image": {
                            "type": "string",
                            "const": "pcit/github-release",
                            "description": "plugin image name"
                        },
                        "with": {
                            "type": "object",
                            "description": "plugin settings",
                            "properties": {
                                "token": {
                                    "type": "string",
                                    "description": "GitHub oauth token with public_repo or repo permission, see https://help.github.com/articles/creating-a-personal-access-token-for-the-command-line/",
                                    "default": "${GITHUB_TOKEN}"
                                },
                                "repo": {
                                    "type": "string",
                                    "description": "github repository name"
                                },
                                "files": {
                                    "type": "array",
                                    "uniqueItems": true,
                                    "description": "files to upload to GitHub Release, globs are allowed",
                                    "items": {
                                        "type": "string"
                                    },
                                    "minItems": 1,
                                    "default": "dist/*",
                                    "examples": [
                                        "dist/*",
                                        "bin/binary.exe"
                                    ]
                                },
                                "checksum": {
                                    "type": "array",
                                    "uniqueItems": true,
                                    "minItems": 1,
                                    "description": "checksum takes hash methods to include in your GitHub release for the files specified.",
                                    "items": {
                                        "enum": [
                                            "md5",
                                            "sha1",
                                            "sha256",
                                            "sha512",
                                            "adler32",
                                            "crc32"
                                        ]
                                    },
                                    "default": [
                                        [
                                            "sha256"
                                        ]
                                    ]
                                },
                                "checksum_file": {
                                    "type": "string",
                                    "description": "name used for checksum file. \"CHECKSUM\" is replaced with the chosen method",
                                    "default": "CHECKSUMsum.txt"
                                },
                                "checksum_flatten": {
                                    "type": "boolean",
                                    "description": "include only the basename of the file in the checksum file",
                                    "default": false
                                },
                                "draft": {
                                    "type": "boolean",
                                    "description": "create a draft release if set to true",
                                    "default": false
                                },
                                "prerelease": {
                                    "type": "boolean",
                                    "description": "set the release as prerelease if set to true",
                                    "default": false
                                },
                                "file_exists": {
                                    "type": "string",
                                    "description": "what to do if an file asset already exists",
                                    "enum": [
                                        "overwrite",
                                        "skip",
                                        "fail"
                                    ],
                                    "default": "overwrite"
                                },
                                "target_commitish": {
                                    "type": "string",
                                    "description": "target commitish",
                                    "examples": [
                                        "refs/tags/nightly"
                                    ]
                                },
                                "note": {
                                    "type": "string",
                                    "description": "file or string with notes for the release, see https://help.github.com/en/github/administering-a-repository/managing-releases-in-a-repository#creating-a-release"
                                },
                                "title": {
                                    "type": "string",
                                    "description": "file or string for the title shown in the github release, see https://help.github.com/en/github/administering-a-repository/managing-releases-in-a-repository#creating-a-release"
                                },
                                "overwrite": {
                                    "type": "boolean",
                                    "description": "force overwrite existing release informations (only title and note)",
                                    "default": false
                                }
                            },
                            "additionalProperties": false,
                            "required": [
                                "token",
                                "files"
                            ]
                        },
                        "if": {
                            "$ref": "#/definitions/if"
                        },
                        "pull": {
                            "$ref": "#/definitions/pull"
                        },
                        "privileged": {
                            "$ref": "#/definitions/privileged"
                        },
                        "read_only": {
                            "$ref": "#/definitions/read_only"
                        },
                        "additionalProperties": false
                    },
                    "required": [
                        "image"
                    ],
                    "additionalProperties": false,
                    "type": "object"
                },
                {
                    "properties": {
                        "image": {
                            "type": "string",
                            "const": "pcit/demo",
                            "description": "plugin image name"
                        },
                        "with": {
                            "properties": {
                                "var": {
                                    "type": "string",
                                    "description": "value is string",
                                    "default": " 1"
                                },
                                "var_array": {
                                    "type": "array",
                                    "uniqueItems": true,
                                    "minItems": 1,
                                    "description": "value is array",
                                    "default": [
                                        "\n  - a\n  - b"
                                    ]
                                },
                                "var_obj": {
                                    "type": "object",
                                    "description": "value is object",
                                    "default": [
                                        "\n  k1: v1\n  k2: v2"
                                    ]
                                }
                            },
                            "description": "plugin settings",
                            "additionalProperties": false
                        },
                        "if": {
                            "$ref": "#/definitions/if"
                        },
                        "pull": {
                            "$ref": "#/definitions/pull"
                        },
                        "privileged": {
                            "$ref": "#/definitions/privileged"
                        },
                        "read_only": {
                            "$ref": "#/definitions/read_only"
                        },
                        "additionalProperties": false
                    },
                    "additionalProperties": false,
                    "description": "this is a pcit demo plugin",
                    "required": [
                        "image"
                    ],
                    "type": "object"
                },
                {
                    "properties": {
                        "image": {
                            "type": "string",
                            "const": "pcit/upload-artifact",
                            "description": "pcit upload artifact plugin"
                        },
                        "with": {
                            "properties": {
                                "name": {
                                    "type": "string",
                                    "description": "artifact name"
                                },
                                "path": {
                                    "type": "string",
                                    "description": "artifact local path"
                                }
                            },
                            "required": [
                                "name",
                                "path"
                            ],
                            "description": "plugin settings",
                            "additionalProperties": false
                        },
                        "if": {
                            "$ref": "#/definitions/if"
                        },
                        "pull": {
                            "$ref": "#/definitions/pull"
                        },
                        "privileged": {
                            "$ref": "#/definitions/privileged"
                        },
                        "read_only": {
                            "$ref": "#/definitions/read_only"
                        },
                        "additionalProperties": false
                    },
                    "additionalProperties": false,
                    "description": "pcit upload artifact plugin",
                    "required": [
                        "image",
                        "with"
                    ],
                    "type": "object"
                },
                {
                    "type": "object",
                    "description": "The Docker plugin can be used to build and publish images to the Docker registry.",
                    "properties": {
                        "image": {
                            "type": "string",
                            "const": "pcit/docker",
                            "description": "plugin image name"
                        },
                        "with": {
                            "type": "object",
                            "description": "plugin settings",
                            "properties": {
                                "registry": {
                                    "type": "string",
                                    "description": "docker registry"
                                },
                                "repo": {
                                    "type": [
                                        "string",
                                        "array"
                                    ],
                                    "description": "docker repo, examples: username/image_name:tag"
                                },
                                "target": {
                                    "type": "string",
                                    "description": "--target"
                                },
                                "username": {
                                    "type": "string",
                                    "description": "docker registry username"
                                },
                                "password": {
                                    "type": "string",
                                    "description": "docker registry password"
                                },
                                "dry_run": {
                                    "type": "boolean",
                                    "description": "don't push",
                                    "default": false
                                },
                                "context": {
                                    "type": "string",
                                    "description": "docker build context",
                                    "default": " ."
                                },
                                "dockerfile": {
                                    "type": "string",
                                    "description": "-f, --file",
                                    "default": " Dockerfile"
                                },
                                "buildx_image": {
                                    "type": "string",
                                    "description": "docker buildx create --driver-opt image= , e.g.\nmoby/buildkit:buildx-stable-1\ndockerpracticesig/buildkit:master",
                                    "default": " moby/buildkit:buildx-stable-1"
                                },
                                "pull": {
                                    "type": "boolean",
                                    "description": "--pull",
                                    "default": false
                                },
                                "build_args": {
                                    "type": "array",
                                    "uniqueItems": true,
                                    "minItems": 1,
                                    "description": "--build-arg"
                                },
                                "cache_from": {
                                    "type": "array",
                                    "uniqueItems": true,
                                    "minItems": 1,
                                    "description": "--cache-from, please replace ',' with '%2C'\ne.g.\nuser/app:cache, type=local%2Csrc=path/to/dir"
                                },
                                "cache_to": {
                                    "type": "array",
                                    "uniqueItems": true,
                                    "minItems": 1,
                                    "description": "--cache-to, please replace ',' with '%2C'\ne.g.\nuser/app:cache, type=local%2Cdest=path/to/dir"
                                },
                                "secret": {
                                    "type": "array",
                                    "uniqueItems": true,
                                    "minItems": 1,
                                    "description": "--secret, please replace ',' with '%2C'\ne.g.\nid=mysecret%2Csrc=/local/secret"
                                },
                                "output": {
                                    "type": "array",
                                    "uniqueItems": true,
                                    "minItems": 1,
                                    "description": "--output, please replace ',' with '%2C'\ne.g.\ntype=local%2Cdest=path"
                                },
                                "platform": {
                                    "type": "array",
                                    "uniqueItems": true,
                                    "minItems": 1,
                                    "description": "--platform",
                                    "items": {
                                        "enum": [
                                            "linux/amd64",
                                            "linux/arm64",
                                            "linux/ppc64le",
                                            "linux/s390x",
                                            "linux/386",
                                            "linux/arm/v7",
                                            "linux/arm/v6"
                                        ]
                                    }
                                },
                                "labels": {
                                    "type": "array",
                                    "uniqueItems": true,
                                    "minItems": 1,
                                    "description": "--label",
                                    "default": [
                                        "\n  - org.opencontainers.image.revision=${PCIT_COMMIT}\n  - org.opencontainers.image.source=https://github.com/${PCIT_REPO_SLUG}"
                                    ]
                                },
                                "no_cache": {
                                    "type": "boolean",
                                    "description": "--no-cache",
                                    "default": false
                                }
                            },
                            "additionalProperties": false,
                            "required": [
                                "repo",
                                "username",
                                "password"
                            ]
                        },
                        "if": {
                            "$ref": "#/definitions/if"
                        },
                        "pull": {
                            "$ref": "#/definitions/pull"
                        },
                        "privileged": {
                            "$ref": "#/definitions/privileged"
                        },
                        "read_only": {
                            "$ref": "#/definitions/read_only"
                        },
                        "additionalProperties": false
                    },
                    "additionalProperties": false,
                    "required": [
                        "image"
                    ]
                },
                {
                    "type": "object",
                    "description": "The pages plugin is used to push dir to git.",
                    "properties": {
                        "image": {
                            "type": "string",
                            "const": "pcit/pages",
                            "description": "plugin image name"
                        },
                        "with": {
                            "type": "object",
                            "description": "plugin settings",
                            "properties": {
                                "username": {
                                    "type": "string",
                                    "description": "git username",
                                    "default": " pcit-ce"
                                },
                                "target_branch": {
                                    "type": "string",
                                    "description": "git branch",
                                    "default": " gh-pages"
                                },
                                "git_url": {
                                    "type": "string",
                                    "description": " git url"
                                },
                                "local_dir": {
                                    "type": "string",
                                    "description": "local dir"
                                },
                                "email": {
                                    "type": "string",
                                    "description": "git email",
                                    "default": " ci@khs1994.com"
                                },
                                "keep_history": {
                                    "type": "boolean",
                                    "description": "keep history",
                                    "default": false
                                },
                                "git_token": {
                                    "type": "string",
                                    "description": "git token",
                                    "default": [
                                        " ${GITHUB_TOKEN}"
                                    ]
                                },
                                "message": {
                                    "type": "string",
                                    "description": "git commit message",
                                    "default": " Deploy Git by PCIT https://ci.khs1994.com"
                                }
                            },
                            "additionalProperties": false,
                            "required": [
                                "git_url",
                                "local_dir",
                                "git_token"
                            ]
                        },
                        "if": {
                            "$ref": "#/definitions/if"
                        },
                        "pull": {
                            "$ref": "#/definitions/pull"
                        },
                        "privileged": {
                            "$ref": "#/definitions/privileged"
                        },
                        "read_only": {
                            "$ref": "#/definitions/read_only"
                        },
                        "additionalProperties": false
                    },
                    "additionalProperties": false,
                    "required": [
                        "image"
                    ]
                },
                {
                    "type": "object",
                    "description": "The S3 plugin uploads files and build artifacts to your S3 bucket, or S3-compatible(example: Minio).",
                    "properties": {
                        "image": {
                            "type": "string",
                            "const": "pcit/s3",
                            "description": "plugin image name"
                        },
                        "with": {
                            "type": "object",
                            "description": "plugin settings",
                            "properties": {
                                "endpoint": {
                                    "type": "string",
                                    "description": "s3 endpoint"
                                },
                                "access_key_id": {
                                    "type": "string",
                                    "description": "s3 access key id"
                                },
                                "secret_access_key": {
                                    "type": "string",
                                    "description": "s3 access key"
                                },
                                "bucket": {
                                    "type": "string",
                                    "description": "s3 bucket"
                                },
                                "region": {
                                    "type": "string",
                                    "description": "s3 region",
                                    "default": " us-east-1"
                                },
                                "cache": {
                                    "type": "array",
                                    "uniqueItems": true,
                                    "minItems": 1,
                                    "description": "cache dir array"
                                },
                                "cache_prefix": {
                                    "type": "string",
                                    "description": "cache prefix"
                                },
                                "cache_download": {
                                    "type": "boolean",
                                    "description": "download cache",
                                    "default": false
                                },
                                "use_path_style_endpoint": {
                                    "type": "boolean",
                                    "description": "when use minio, please set true",
                                    "default": false
                                },
                                "connect_timeout": {
                                    "type": "string",
                                    "description": "connect timeout, s",
                                    "default": 20
                                },
                                "acl": {
                                    "type": "string",
                                    "description": "see https://docs.aws.amazon.com/zh_cn/AmazonS3/latest/dev/acl-overview.html#canned-acl",
                                    "default": " public-read",
                                    "enum": [
                                        "private",
                                        "public-read",
                                        "public-read-write"
                                    ]
                                },
                                "local_dir": {
                                    "type": "string",
                                    "description": "local dir"
                                },
                                "upload_dir": {
                                    "type": "string",
                                    "description": "s3 dir"
                                },
                                "files": {
                                    "type": [
                                        "object",
                                        "array"
                                    ],
                                    "description": "dir,dir2 or local_path:s3_path"
                                }
                            },
                            "additionalProperties": false,
                            "required": [
                                "endpoint",
                                "access_key_id",
                                "secret_access_key",
                                "bucket"
                            ]
                        },
                        "if": {
                            "$ref": "#/definitions/if"
                        },
                        "pull": {
                            "$ref": "#/definitions/pull"
                        },
                        "privileged": {
                            "$ref": "#/definitions/privileged"
                        },
                        "read_only": {
                            "$ref": "#/definitions/read_only"
                        },
                        "additionalProperties": false
                    },
                    "additionalProperties": false,
                    "required": [
                        "image"
                    ]
                },
                {
                    "type": "object",
                    "description": "The NPM plugin can be used to publish libraries to public or private registries.",
                    "properties": {
                        "image": {
                            "type": "string",
                            "const": "pcit/npm",
                            "description": "plugin image name"
                        },
                        "with": {
                            "type": "object",
                            "description": "plugin setting",
                            "properties": {
                                "username": {
                                    "type": "string",
                                    "description": "npm username"
                                },
                                "password": {
                                    "type": "string",
                                    "description": "npm user password"
                                },
                                "email": {
                                    "type": "string",
                                    "description": "npm user email"
                                },
                                "token": {
                                    "type": "string",
                                    "description": "npm user token"
                                },
                                "tag": {
                                    "type": "string",
                                    "description": "npm package tag, --tag",
                                    "default": " current"
                                },
                                "registry": {
                                    "type": "string",
                                    "description": "--registry",
                                    "default": " https://registry.npmjs.org"
                                },
                                "skip_verify": {
                                    "type": "boolean",
                                    "description": "skip verify https",
                                    "default": false
                                },
                                "fail_on_version_conflict": {
                                    "type": "boolean",
                                    "description": "fail on version conflict",
                                    "default": true
                                },
                                "access": {
                                    "type": "string",
                                    "description": "--access <public|restricted>",
                                    "default": " public",
                                    "enum": [
                                        "public",
                                        "restricted"
                                    ]
                                }
                            },
                            "additionalProperties": false
                        },
                        "if": {
                            "$ref": "#/definitions/if"
                        },
                        "pull": {
                            "$ref": "#/definitions/pull"
                        },
                        "privileged": {
                            "$ref": "#/definitions/privileged"
                        },
                        "read_only": {
                            "$ref": "#/definitions/read_only"
                        },
                        "additionalProperties": false
                    },
                    "additionalProperties": false,
                    "required": [
                        "image"
                    ]
                },
                {
                    "type": "object",
                    "description": "The Qiniu plugin uploads files and build artifacts to your Qiniu bucket.",
                    "properties": {
                        "image": {
                            "type": "string",
                            "const": "pcit/qiniu",
                            "description": "plugin image name"
                        },
                        "with": {
                            "type": "object",
                            "description": "plugin settings",
                            "properties": {
                                "secret_key": {
                                    "type": "string",
                                    "description": "qiniu secret key, copy from https://portal.qiniu.com/user/key"
                                },
                                "access_key": {
                                    "type": "string",
                                    "description": "qiniu access key, copy from https://portal.qiniu.com/user/key"
                                },
                                "bucket": {
                                    "type": "string",
                                    "description": "qiniu bucket, get from https://portal.qiniu.com/kodo/bucket"
                                },
                                "endpoint": {
                                    "type": "string",
                                    "description": "qiniu endpoint"
                                },
                                "files": {
                                    "type": [
                                        "object",
                                        "array"
                                    ],
                                    "description": "dir,dir2 or local_path:qiniu_path"
                                }
                            },
                            "additionalProperties": false,
                            "required": [
                                "secret_key",
                                "access_key",
                                "bucket",
                                "endpoint",
                                "files"
                            ]
                        },
                        "if": {
                            "$ref": "#/definitions/if"
                        },
                        "pull": {
                            "$ref": "#/definitions/pull"
                        },
                        "privileged": {
                            "$ref": "#/definitions/privileged"
                        },
                        "read_only": {
                            "$ref": "#/definitions/read_only"
                        },
                        "additionalProperties": false
                    },
                    "additionalProperties": false,
                    "required": [
                        "image"
                    ]
                },
                {
                    "type": "object",
                    "description": "The COSv5 plugin uploads files and build artifacts to your COSv5 bucket.",
                    "properties": {
                        "image": {
                            "type": "string",
                            "const": "pcit/tencent-cos:v5",
                            "description": "plugin image name"
                        },
                        "with": {
                            "type": "object",
                            "description": "plugin settings",
                            "properties": {
                                "region": {
                                    "type": "string",
                                    "description": "cos v5 region, see https://cloud.tencent.com/document/product/436/6224\nap-beijing-1\nap-beijing\nap-nanjing\nap-shanghai\nap-guangzhou\nap-chengdu\nap-chongqing\nap-shenzhen-fsi\nap-shanghai-fsi\nap-beijing-fsi"
                                },
                                "app_id": {
                                    "type": "string",
                                    "description": "cos v5 app id, copy from https://console.cloud.tencent.com/cam/capi"
                                },
                                "secret_key": {
                                    "type": "string",
                                    "description": "cos v5 secret key, copy from https://console.cloud.tencent.com/cam/capi"
                                },
                                "secret_id": {
                                    "type": "string",
                                    "description": "cos v5 secret id, copy from https://console.cloud.tencent.com/cam/capi"
                                },
                                "bucket": {
                                    "type": "string",
                                    "description": "cos v5 bucket, get from https://console.cloud.tencent.com/cos5/bucket"
                                },
                                "prefix": {
                                    "type": "string",
                                    "description": "cos v5 prefix"
                                },
                                "files": {
                                    "type": [
                                        "object",
                                        "array"
                                    ],
                                    "description": "dir,dir2 or local_path:cos_v5_path"
                                }
                            },
                            "additionalProperties": false,
                            "required": [
                                "region",
                                "app_id",
                                "secret_key",
                                "secret_id",
                                "bucket",
                                "files"
                            ]
                        },
                        "if": {
                            "$ref": "#/definitions/if"
                        },
                        "pull": {
                            "$ref": "#/definitions/pull"
                        },
                        "privileged": {
                            "$ref": "#/definitions/privileged"
                        },
                        "read_only": {
                            "$ref": "#/definitions/read_only"
                        },
                        "additionalProperties": false
                    },
                    "additionalProperties": false,
                    "required": [
                        "image"
                    ]
                }
            ]
        },
        "pull": {
            "description": "see https://docs.ci.khs1994.com/usage/steps.html#_4-pull",
            "type": "boolean",
            "default": false
        },
        "privileged": {
            "description": "see https://docs.ci.khs1994.com/usage/steps.html#_7-privileged",
            "type": "boolean",
            "default": false
        },
        "step_settings": {
            "type": "object",
            "description": "step settings",
            "patternProperties": {
                "^[_a-zA-Z][a-zA-Z0-9_-]*$": {
                    "oneOf": [
                        {
                            "type": "string",
                            "description": "value is string"
                        },
                        {
                            "type": "array",
                            "uniqueItems": true,
                            "description": "value is array"
                        },
                        {
                            "type": "object",
                            "description": "value is object"
                        },
                        {
                            "type": "boolean",
                            "description": "value is boolean"
                        },
                        {
                            "type": "integer",
                            "description": "value is boolean"
                        }
                    ]
                }
            }
        },
        "image": {
            "type": "string",
            "description": "step container image name",
            "not": {
                "enum": [
                    "pcit/github-release",
                    "pcit/demo"
                ]
            }
        },
        "command": {
            "oneOf": [
                {
                    "type": "string",
                    "description": "defined command with string, see https://docs.ci.khs1994.com/usage/steps.html#_2-run"
                },
                {
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "description": "defined command with array, see https://docs.ci.khs1994.com/usage/steps.html#_2-run"
                }
            ]
        },
        "service": {
            "anyOf": [
                {
                    "type": "null",
                    "description": "run service container with default settings"
                },
                {
                    "type": "object",
                    "description": "run service container with custom settings",
                    "properties": {
                        "env": {
                            "$ref": "#/definitions/env"
                        },
                        "image": {
                            "type": "string",
                            "description": "service container image name"
                        },
                        "entrypoint": {
                            "type": "array"
                        },
                        "command": {
                            "type": "array"
                        }
                    },
                    "additionalProperties": false
                }
            ]
        },
        "env": {
            "type": "array",
            "items": {
                "type": "string"
            },
            "uniqueItems": true,
            "description": "example\n env:\n- k=v\nsee https://docs.ci.khs1994.com/usage/steps.html#_3-env"
        },
        "branch": {
            "oneOf": [
                {
                    "type": "string",
                    "description": "setting branch with string"
                },
                {
                    "type": "array",
                    "uniqueItems": true,
                    "description": "setting branch with array"
                },
                {
                    "type": "object",
                    "properties": {
                        "include": {
                            "oneOf": [
                                {
                                    "type": "string",
                                    "description": "setting branch include with string"
                                },
                                {
                                    "type": "array",
                                    "uniqueItems": true,
                                    "minItems": 1,
                                    "description": "setting branch include with array"
                                }
                            ]
                        }
                    },
                    "required": [
                        "include"
                    ],
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "exclude": {
                            "oneOf": [
                                {
                                    "type": "string",
                                    "description": "setting branch exclude with string"
                                },
                                {
                                    "type": "array",
                                    "uniqueItems": true,
                                    "minItems": 1,
                                    "description": "setting branch exclude with array"
                                }
                            ]
                        }
                    },
                    "required": [
                        "exclude"
                    ],
                    "additionalProperties": false
                }
            ]
        },
        "git": {
            "type": "object",
            "description": "setting git clone, see https://docs.ci.khs1994.com/usage/clone.html",
            "properties": {
                "image": {
                    "type": "string",
                    "description": "run git clone container image name",
                    "default": "pcit/git"
                },
                "depth": {
                    "type": "integer",
                    "description": "clone depth",
                    "default": 25
                },
                "hosts": {
                    "$ref": "#/definitions/hosts"
                },
                "recursive": {
                    "type": "boolean",
                    "description": "clone submodules",
                    "default": false
                },
                "skip_verify": {
                    "type": "boolean",
                    "description": "skip tls verification",
                    "default": false
                },
                "tags": {
                    "type": "boolean",
                    "description": "clone tags",
                    "default": false
                },
                "submodule_override": {
                    "type": "object",
                    "description": "submodule overrides, example:\n path: git_url"
                },
                "disable": {
                    "type": "boolean",
                    "description": "disable git clone",
                    "default": false
                }
            },
            "additionalProperties": false
        },
        "hosts": {
            "type": "array",
            "uniqueItems": true,
            "description": "example:\n\nhosts:\n- \"pcit.dev:127.0.0.1\"\n\nsee https://docs.docker.com/compose/compose-file/#extra_hosts",
            "items": {
                "type": "string"
            },
            "examples": [
                [
                    "pcit.dev:127.0.0.1"
                ]
            ]
        },
        "platform": {
            "enum": [
                "linux/amd64",
                "linux/arm64",
                "linux/ppc64le",
                "linux/s390x",
                "linux/386",
                "linux/arm/v7",
                "linux/arm/v6",
                "windows/amd64"
            ],
            "description": "container platform, see https://github.com/containerd/containerd/blob/master/platforms/platforms.go"
        },
        "status": {
            "enum": [
                "failure",
                "success",
                "changed"
            ]
        },
        "event": {
            "enum": [
                "push",
                "pull_request",
                "tag",
                "cron",
                "repository_dispatch"
            ]
        },
        "if_include": {
            "type": "object",
            "properties": {
                "include": {
                    "oneOf": [
                        {
                            "type": "string"
                        },
                        {
                            "type": "array",
                            "uniqueItems": true,
                            "minItems": 1
                        }
                    ]
                }
            },
            "required": [
                "include"
            ],
            "additionalProperties": false
        },
        "if_exclude": {
            "type": "object",
            "properties": {
                "exclude": {
                    "oneOf": [
                        {
                            "type": "string"
                        },
                        {
                            "type": "array",
                            "uniqueItems": true,
                            "minItems": 1
                        }
                    ]
                }
            },
            "required": [
                "exclude"
            ],
            "additionalProperties": false
        },
        "if_event": {
            "oneOf": [
                {
                    "type": "string",
                    "$ref": "#/definitions/event"
                },
                {
                    "type": "array",
                    "uniqueItems": true,
                    "minItems": 1,
                    "items": {
                        "$ref": "#/definitions/event"
                    }
                }
            ]
        },
        "if_event_include": {
            "type": "object",
            "properties": {
                "include": {
                    "$ref": "#/definitions/if_event"
                }
            },
            "required": [
                "include"
            ],
            "additionalProperties": false
        },
        "if_event_exclude": {
            "type": "object",
            "properties": {
                "exclude": {
                    "$ref": "#/definitions/if_event"
                }
            },
            "required": [
                "exclude"
            ],
            "additionalProperties": false
        },
        "if_platform": {
            "oneOf": [
                {
                    "type": "string",
                    "$ref": "#/definitions/platform"
                },
                {
                    "type": "array",
                    "uniqueItems": true,
                    "minItems": 1,
                    "items": {
                        "$ref": "#/definitions/platform"
                    }
                }
            ]
        },
        "if_platform_include": {
            "type": "object",
            "properties": {
                "include": {
                    "$ref": "#/definitions/if_platform"
                }
            },
            "required": [
                "include"
            ],
            "additionalProperties": false
        },
        "if_platform_exclude": {
            "type": "object",
            "properties": {
                "exclude": {
                    "$ref": "#/definitions/if_platform"
                }
            },
            "required": [
                "exclude"
            ],
            "additionalProperties": false
        },
        "if_status": {
            "oneOf": [
                {
                    "type": "string",
                    "$ref": "#/definitions/status"
                },
                {
                    "type": "array",
                    "uniqueItems": true,
                    "minItems": 1,
                    "items": {
                        "$ref": "#/definitions/status"
                    }
                }
            ]
        },
        "if_status_include": {
            "type": "object",
            "properties": {
                "include": {
                    "$ref": "#/definitions/if_status"
                }
            },
            "required": [
                "include"
            ],
            "additionalProperties": false
        },
        "if_status_exclude": {
            "type": "object",
            "properties": {
                "exclude": {
                    "$ref": "#/definitions/if_status"
                }
            },
            "required": [
                "exclude"
            ],
            "additionalProperties": false
        },
        "if": {
            "type": "object",
            "description": "see https://docs.ci.khs1994.com/usage/steps.html#_6-if",
            "properties": {
                "status": {
                    "description": "string or array, one of \nfailure \nsuccess \nchanged",
                    "oneOf": [
                        {
                            "type": "string",
                            "$ref": "#/definitions/status",
                            "examples": [
                                "failure"
                            ]
                        },
                        {
                            "type": "array",
                            "uniqueItems": true,
                            "items": {
                                "$ref": "#/definitions/status"
                            },
                            "examples": [
                                [
                                    "failure"
                                ]
                            ]
                        },
                        {
                            "$ref": "#/definitions/if_status_include"
                        },
                        {
                            "$ref": "#/definitions/if_status_exclude"
                        }
                    ]
                },
                "event": {
                    "description": "string or array, one of \npush \npull_request \ntag \ncron \nrepository_dispatch",
                    "oneOf": [
                        {
                            "type": "string",
                            "$ref": "#/definitions/event",
                            "examples": [
                                "push"
                            ]
                        },
                        {
                            "type": "array",
                            "uniqueItems": true,
                            "items": {
                                "$ref": "#/definitions/event"
                            },
                            "examples": [
                                [
                                    "push",
                                    "tag"
                                ]
                            ]
                        },
                        {
                            "$ref": "#/definitions/if_event_include"
                        },
                        {
                            "$ref": "#/definitions/if_event_exclude"
                        }
                    ]
                },
                "platform": {
                    "oneOf": [
                        {
                            "type": "string",
                            "$ref": "#/definitions/platform",
                            "description": "set container platform with string"
                        },
                        {
                            "type": "array",
                            "uniqueItems": true,
                            "items": {
                                "$ref": "#/definitions/platform"
                            },
                            "description": "set container platform with array"
                        },
                        {
                            "$ref": "#/definitions/if_platform_include"
                        },
                        {
                            "$ref": "#/definitions/if_platform_exclude"
                        }
                    ]
                },
                "branch": {
                    "$ref": "#/definitions/branch"
                },
                "tag": {
                    "$ref": "#/definitions/branch"
                },
                "jobs": {
                    "oneOf": [
                        {
                            "type": "array",
                            "uniqueItems": true,
                            "description": "see https://docs.ci.khs1994.com/usage/steps.html#_6-if",
                            "items": {
                                "type": "object"
                            }
                        },
                        {
                            "type": "object",
                            "description": "only run on this jobs",
                            "properties": {
                                "include": {
                                    "type": "array",
                                    "description": "only run on this jobs",
                                    "items": {
                                        "type": "object"
                                    },
                                    "uniqueItems": true,
                                    "minItems": 1
                                }
                            },
                            "required": [
                                "include"
                            ],
                            "additionalProperties": false
                        },
                        {
                            "type": "object",
                            "description": "don't run on this jobs",
                            "properties": {
                                "exclude": {
                                    "type": "array",
                                    "description": "don't run on this jobs",
                                    "items": {
                                        "type": "object"
                                    },
                                    "uniqueItems": true,
                                    "minItems": 1
                                }
                            },
                            "required": [
                                "exclude"
                            ],
                            "additionalProperties": false
                        }
                    ]
                }
            },
            "additionalProperties": false
        },
        "steps": {
            "anyOf": [
                {
                    "$ref": "#/definitions/plugins"
                },
                {
                    "type": "object",
                    "description": "step, see https://docs.ci.khs1994.com/usage/steps.html",
                    "properties": {
                        "image": {
                            "$ref": "#/definitions/image"
                        },
                        "run": {
                            "$ref": "#/definitions/command"
                        },
                        "shell": {
                            "type": "string",
                            "description": "see https://docs.ci.khs1994.com/usage/steps.html#_5-shell",
                            "default": "sh",
                            "anyOf": [
                                {
                                    "enum": [
                                        "bash",
                                        "sh",
                                        "pwsh",
                                        "node",
                                        "deno",
                                        "python"
                                    ]
                                },
                                {
                                    "$comment": ""
                                }
                            ]
                        },
                        "env": {
                            "$ref": "#/definitions/env"
                        },
                        "with": {
                            "$ref": "#/definitions/step_settings"
                        },
                        "pull": {
                            "$ref": "#/definitions/pull"
                        },
                        "privileged": {
                            "$ref": "#/definitions/privileged"
                        },
                        "if": {
                            "$ref": "#/definitions/if"
                        },
                        "read_only": {
                            "$ref": "#/definitions/read_only"
                        },
                        "timeout": {
                            "type": "integer",
                            "description": "timeout sec, e.g. 60",
                            "default": 3600
                        }
                    },
                    "additionalProperties": false
                }
            ]
        },
        "workspace": {
            "type": "object",
            "description": "see https://docs.ci.khs1994.com/usage/workspace.html",
            "properties": {
                "base": {
                    "type": "string"
                },
                "path": {
                    "type": "string"
                }
            },
            "additionalProperties": false
        }
    },
    "allOf": [
        {
            "patternProperties": {
                "^x-.*": {
                    "description": "merge key"
                }
            },
            "properties": {
                "apiVersion": {
                    "type": "string",
                    "enum": [
                        "config.ci.khs1994.com/v1alpha1",
                        "config.ci.khs1994.com/v1alpha2",
                        "config.ci.khs1994.com/v1alpha3",
                        "config.ci.khs1994.com/v1beta1",
                        "config.ci.khs1994.com/v1beta2",
                        "config.ci.khs1994.com/v1beta3",
                        "config.ci.khs1994.com/v1",
                        "config.ci.khs1994.com/v2alpha1"
                    ]
                },
                "kind": {
                    "type": "string",
                    "enum": [
                        "PcitConfig"
                    ]
                },
                "language": {
                    "type": "string",
                    "enum": [
                        "php",
                        "node",
                        "node_js",
                        "node.js",
                        "js",
                        "go",
                        "golang",
                        "java"
                    ],
                    "description": "project language, see https://docs.ci.khs1994.com/usage/language.html"
                },
                "clone": {
                    "type": "object",
                    "description": "git clone, see https://docs.ci.khs1994.com/usage/clone.html",
                    "$comment": "https://docs.ci.khs1994.com/usage/clone.html",
                    "properties": {
                        "git": {
                            "type": "object",
                            "description": "setting git clone",
                            "$ref": "#/definitions/git",
                            "additionalProperties": false
                        }
                    },
                    "additionalProperties": false
                },
                "workspace": {
                    "$ref": "#/definitions/workspace"
                },
                "workdir": {
                    "$ref": "#/definitions/workspace"
                },
                "cache": {
                    "type": [
                        "string",
                        "array"
                    ],
                    "items": {
                        "type": "string"
                    },
                    "description": "see https://docs.ci.khs1994.com/usage/cache.html"
                },
                "steps": {
                    "type": "object",
                    "description": "job step, see https://docs.ci.khs1994.com/usage/steps.html",
                    "patternProperties": {
                        "^[a-zA-Z0-9._-]+$": {
                            "oneOf": [
                                {
                                    "type": "object",
                                    "$ref": "#/definitions/steps"
                                },
                                {
                                    "type": "string",
                                    "description": "step only include command with string fomat, see https://docs.ci.khs1994.com/usage/steps.html"
                                },
                                {
                                    "type": "array",
                                    "description": "step only include command with array fomat, see https://docs.ci.khs1994.com/usage/steps.html",
                                    "items": {
                                        "type": "string"
                                    }
                                }
                            ]
                        }
                    },
                    "additionalProperties": false
                },
                "services": {
                    "type": "object",
                    "$comment": "https://docs.ci.khs1994.com/usage/services.html",
                    "description": "Additional containers to host services for a job. These are useful for creating databases or cache services like redis. see https://docs.ci.khs1994.com/usage/services.html",
                    "patternProperties": {
                        "^[a-zA-Z0-9._-]+$": {
                            "$ref": "#/definitions/service"
                        }
                    },
                    "additionalProperties": false
                },
                "jobs": {
                    "type": "object",
                    "$comment": "https://docs.ci.khs1994.com/usage/jobs.html",
                    "description": "jobs, see https://docs.ci.khs1994.com/usage/jobs.html",
                    "patternProperties": {
                        "^(in|ex)clude$": {
                            "description": "plase see https://help.github.com/en/actions/reference/workflow-syntax-for-github-actions#jobsjob_idstrategy",
                            "type": "array",
                            "items": {
                                "type": "object"
                            },
                            "minItems": 1,
                            "additionalItems": false
                        }
                    },
                    "additionalProperties": {
                        "type": "array",
                        "uniqueItems": true,
                        "description": "env name",
                        "items": {
                            "type": "string",
                            "description": "env value"
                        },
                        "minItems": 1
                    },
                    "minProperties": 1
                },
                "platform": {
                    "type": "array",
                    "$comment": "https://docs.ci.khs1994.com/usage/platform.html",
                    "items": {
                        "$ref": "#/definitions/platform"
                    },
                    "description": "container platform",
                    "minItems": 1,
                    "uniqueItems": true
                },
                "branches": {
                    "$ref": "#/definitions/branch",
                    "$comment": "https://docs.ci.khs1994.com/usage/branches.html",
                    "description": "which branches trigger job, see https://docs.ci.khs1994.com/usage/branches.html"
                },
                "hosts": {
                    "type": "array",
                    "uniqueItems": true,
                    "description": "setting step container hosts, see https://docs.ci.khs1994.com/usage/hosts.html"
                },
                "networks": {
                    "type": "array",
                    "$comment": "https://docs.ci.khs1994.com/usage/networks.html",
                    "description": "setting step container network, see https://docs.ci.khs1994.com/usage/networks.html",
                    "uniqueItems": true
                },
                "hostname": {
                    "type": "string",
                    "$comment": "https://docs.ci.khs1994.com/usage/hostname.html",
                    "description": "setting step container hostname, see https://docs.ci.khs1994.com/usage/hostname.html"
                },
                "image": {
                    "type": "string",
                    "$comment": "https://docs.ci.khs1994.com/usage/image.html",
                    "description": "set step default image, see https://docs.ci.khs1994.com/usage/image.html"
                },
                "timeout": {
                    "type": "integer",
                    "description": "step timeout sec, e.g. 60",
                    "default": 3600
                }
            },
            "additionalProperties": false
        }
    ],
    "required": [
        "steps"
    ]
}
